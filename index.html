<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>El 11 de Boca - Formación dinámica y votación</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EJ9L15DW36"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EJ9L15DW36');
</script>

<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>




<!-- Google Fonts Roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
<!-- Fuente Oswald desde Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet" />

<!-- Meta etiquetas para compartir con el mensaje personalizado -->
<meta property="og:title" content="Armá y votá tu equipo ideal de Boca" />
<meta property="og:description" content="Armá y votá tu equipo ideal de Boca" />
<meta property="og:url" content="https://www.tuoncexeneize.com" />
<meta property="og:type" content="website" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Armá y votá tu equipo ideal de Boca" />
<meta name="twitter:description" content="Armá y votá tu equipo ideal de Boca" />


</head>




<body>


<div class="titulo-principal">
  <h1></h1>
  <p></p>
</div>


<header>TU ONCE XENEIZE        -     Armá y votá tu equipo ideal- </header>


<!-- Datos del partido -->

<div id="info-partido-seleccionado" style="margin-top:10px; color:#F5B041; font-weight:bold;"></div>


<!-- Historial Boca vs Rival -->
<div id="historial-partidos">
  <div class="equipo equipo-boca">
    <img src="img/escudos/boca.png" alt="Boca Juniors">
    <div class="circulo victorias-boca">80</div>
  </div>

  <div class="equipo empates">
    <div class="circulo empates-circulo">26</div>
    <span>Empates</span>
  </div>

  <div class="equipo equipo-rival">
    <img src="img/escudos/central.png" alt="Rival">
    <div class="circulo victorias-rival">43</div>
  </div>
</div>


<div id="contenedor">
  <div id="formacionSelector">
    <label for="formaciones">Formación:</label>
    <select id="formaciones" onchange="renderizarCancha()">
      <option value="">-- Selecciona --</option>
      <option value="4-3-3">4-3-3</option>
      <option value="4-4-2">4-4-2</option>
      <option value="5-4-1">5-4-1</option>
      <option value="4-3-1-2">4-3-1-2</option>
      <option value="4-2-3-1">4-2-3-1</option>
      <option value="3-4-3">3-4-3</option>
      <option value="5-3-2">5-3-2</option>
      <option value="3-5-2">3-5-2</option>
    </select>

    <label for="nickname" style="margin-top:12px;">Ayudante de Campo:</label>
<input type="text" id="nickname" placeholder="Nombre" />

<button class="firebase-btn" onclick="enviarEquipoFirebase()">Enviar Equipo</button>


<details>
  <summary>Datos del partido</summary>
  <p>No jugará: Pellegrino</p>
  <p>No jugará: Zenón</p>
  <p>No jugará: Marchesin</p>
</details>


  </div>
  <div id="cancha"></div>
</div>


 <!-- Importar archivo notas.js y mostrar las notas -->
<script type="module">
  import { notas } from "./notas.js";

  const notasDiv = document.getElementById('notas-jugadores');
  if (notas && notas.length > 0) {
    notasDiv.innerHTML = "<ul style='padding-left:18px; margin:0;'>" 
      + notas.map(n => `<li>${n}</li>`).join('') 
      + "</ul>";
  }
</script>


<!-- 11 Ideal -->
<div id="once-ideal" style="display:none;">
  <h2>Once Ideal</h2>

  <!-- Datos del próximo partido -->
  <div id="datos-proximo-partido" class="info-partido">
    Cargando datos del partido...
  </div>

  <div id="cancha-ideal"></div>
  
    
</div>


<!-- Script para cargar datos del próximo partido -->

<!-- Equipos enviados -->
<h2 id="titulo-equipos">EQUIPOS ENVIADOS</h2>

<label for="filtro-rival" class="titulo-filtro">
  Filtrar por rival:
</label>
<select id="filtro-rival" class="select-filtro">
  <option value="">Todos</option>
  <!-- Opciones se generarán dinámicamente desde JS -->
</select>


<div id="equipos-firebase"></div>
<p id="filtro-info" style="text-align:center; font-weight:bold;"></p>

<div style="display: flex; gap: 10px; margin-top: 20px;">
  <button onclick="shareTwitter()" style="background:#1DA1F2; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer;">
    Compartir en Twitter
  </button>
  <button onclick="shareWhatsApp()" style="background:#25D366; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer;">
    Compartir en WhatsApp
  </button>
</div>

<script>
  const jugadores = {
    ARQ: [
      "Agustin Marchesin",
      "Leandro Brey",
      "Sergio Romero",
      "Javier Garcia"
    ],
    DEF: [
      "Luis Advincula", "Lucas Blondel", "Juan Barinaga",
      "Rodrigo Battaglia", "Nicolas Figal", "Lautaro Di Lollo", "Marco Pellegrino", "Ayrton Costa",
      "Rodrigo Battaglia ",
      "Lautaro Blanco", "Frank Fabra", "Malcom Braida"
    ],
    VOL: [
      "Leandro Paredes", "Milton Delgado", "Tomas Belmonte", "Rodrigo Battaglia",
      "Williams Alarcon", "Ignacio Miramon", "Camilo Rey Domenech", "Agustin Martegani", "Ander Herrera",
      "Carlos Palacios ", "Kevin Zenon", "Brian Aguirre", "Alan Velasco", "Lautaro Blanco", "Frank Fabra", 
      "Ezequiel Zeballos", "Lucas Janson", "Malcom Braida", "Lucas Blondel", "Juan Barinaga",
      "Luis Advincula", "Miguel Merentiel"
    ],
    DEL: [
      "Carlos Palacios ", "Edinson Cavani", "Miguel Merentiel", "Milton Gimenez",
      "Kevin Zenon", "Brian Aguirre", "Alan Velasco", "Ezequiel Zeballos",
      "Lucas Janson", "Malcom Braida"
    ]
  };

  const formaciones = {
    "4-3-3": [
      { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
      { label: "DEF 1", tipo: "DEF", top: 70, left: 20 },
      { label: "DEF 2", tipo: "DEF", top: 70, left: 40 },
      { label: "DEF 3", tipo: "DEF", top: 70, left: 60 },
      { label: "DEF 4", tipo: "DEF", top: 70, left: 80 },
      { label: "VOL 1", tipo: "VOL", top: 50, left: 30 },
      { label: "VOL 2", tipo: "VOL", top: 50, left: 50 },
      { label: "VOL 3", tipo: "VOL", top: 50, left: 70 },
      { label: "DEL 1", tipo: "DEL", top: 25, left: 25 },
      { label: "DEL 2", tipo: "DEL", top: 25, left: 50 },
      { label: "DEL 3", tipo: "DEL", top: 25, left: 75 },
    ],
    "4-4-2": [
      { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
      { label: "DEF 1", tipo: "DEF", top: 70, left: 20 },
      { label: "DEF 2", tipo: "DEF", top: 70, left: 40 },
      { label: "DEF 3", tipo: "DEF", top: 70, left: 60 },
      { label: "DEF 4", tipo: "DEF", top: 70, left: 80 },
      { label: "VOL 1", tipo: "VOL", top: 50, left: 20 },
      { label: "VOL 2", tipo: "VOL", top: 50, left: 40 },
      { label: "VOL 3", tipo: "VOL", top: 50, left: 60 },
      { label: "VOL 4", tipo: "VOL", top: 50, left: 80 },
      { label: "DEL 1", tipo: "DEL", top: 25, left: 35 },
      { label: "DEL 2", tipo: "DEL", top: 25, left: 65 },
    ],
    "5-4-1": [
      { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
      { label: "DEF 1", tipo: "DEF", top: 70, left: 10 },
      { label: "DEF 2", tipo: "DEF", top: 70, left: 30 },
      { label: "DEF 3", tipo: "DEF", top: 70, left: 50 },
      { label: "DEF 4", tipo: "DEF", top: 70, left: 70 },
      { label: "DEF 5", tipo: "DEF", top: 70, left: 90 },
      { label: "VOL 1", tipo: "VOL", top: 50, left: 25 },
      { label: "VOL 2", tipo: "VOL", top: 50, left: 45 },
      { label: "VOL 3", tipo: "VOL", top: 50, left: 65 },
      { label: "VOL 4", tipo: "VOL", top: 50, left: 85 },
      { label: "DEL 1", tipo: "DEL", top: 25, left: 50 },
    ],
    "4-3-1-2": [
      { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
      { label: "DEF 1", tipo: "DEF", top: 70, left: 20 },
      { label: "DEF 2", tipo: "DEF", top: 70, left: 40 },
      { label: "DEF 3", tipo: "DEF", top: 70, left: 60 },
      { label: "DEF 4", tipo: "DEF", top: 70, left: 80 },
      { label: "VOL 1", tipo: "VOL", top: 50, left: 30 },
      { label: "VOL 2", tipo: "VOL", top: 50, left: 50 },
      { label: "VOL 3", tipo: "VOL", top: 50, left: 70 },
      { label: "VOL 4", tipo: "VOL", top: 30, left: 50 }, // El 1 volante ofensivo
      { label: "DEL 1", tipo: "DEL", top: 25, left: 35 },
      { label: "DEL 2", tipo: "DEL", top: 25, left: 65 },
    ],
    "4-2-3-1": [
     { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
     { label: "DEF 1", tipo: "DEF", top: 70, left: 20 },
     { label: "DEF 2", tipo: "DEF", top: 70, left: 40 },
     { label: "DEF 3", tipo: "DEF", top: 70, left: 60 },
     { label: "DEF 4", tipo: "DEF", top: 70, left: 80 },
     { label: "VOL 1", tipo: "VOL", top: 55, left: 35 },
     { label: "VOL 2", tipo: "VOL", top: 55, left: 65 },
     { label: "VOL 3", tipo: "VOL", top: 40, left: 25 },
     { label: "VOL 4", tipo: "VOL", top: 40, left: 50 },
     { label: "VOL 5", tipo: "VOL", top: 40, left: 75 },
     { label: "DEL 1", tipo: "DEL", top: 20, left: 50 }
    ],
    "3-4-3": [
     { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
     { label: "DEF 1", tipo: "DEF", top: 70, left: 35 },
     { label: "DEF 2", tipo: "DEF", top: 70, left: 50 },
     { label: "DEF 3", tipo: "DEF", top: 70, left: 65 },
     { label: "VOL 1", tipo: "VOL", top: 50, left: 20 },
     { label: "VOL 2", tipo: "VOL", top: 50, left: 40 },
     { label: "VOL 3", tipo: "VOL", top: 50, left: 60 },
     { label: "VOL 4", tipo: "VOL", top: 50, left: 80 },
     { label: "DEL 1", tipo: "DEL", top: 25, left: 30 },
     { label: "DEL 2", tipo: "DEL", top: 25, left: 50 },
     { label: "DEL 3", tipo: "DEL", top: 25, left: 70 }
     ],
     "5-3-2": [
     { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
     { label: "DEF 1", tipo: "DEF", top: 70, left: 15 },
     { label: "DEF 2", tipo: "DEF", top: 70, left: 30 },
     { label: "DEF 3", tipo: "DEF", top: 70, left: 50 },
     { label: "DEF 4", tipo: "DEF", top: 70, left: 70 },
     { label: "DEF 5", tipo: "DEF", top: 70, left: 85 },
     { label: "VOL 1", tipo: "VOL", top: 50, left: 35 },
     { label: "VOL 2", tipo: "VOL", top: 50, left: 50 },
     { label: "VOL 3", tipo: "VOL", top: 50, left: 65 },
     { label: "DEL 1", tipo: "DEL", top: 25, left: 40 },
     { label: "DEL 2", tipo: "DEL", top: 25, left: 60 }
     ],
     "3-5-2": [
     { label: "ARQ 1", tipo: "ARQ", top: 90, left: 50 },
     { label: "DEF 1", tipo: "DEF", top: 70, left: 35 },
     { label: "DEF 2", tipo: "DEF", top: 70, left: 50 },
     { label: "DEF 3", tipo: "DEF", top: 70, left: 65 },
     { label: "VOL 1", tipo: "VOL", top: 50, left: 15 },
     { label: "VOL 2", tipo: "VOL", top: 50, left: 35 },
     { label: "VOL 3", tipo: "VOL", top: 55, left: 50 },
     { label: "VOL 4", tipo: "VOL", top: 50, left: 65 },
     { label: "VOL 5", tipo: "VOL", top: 50, left: 85 },
     { label: "DEL 1", tipo: "DEL", top: 25, left: 40 },
     { label: "DEL 2", tipo: "DEL", top: 25, left: 60 }
    ]

};

  function renderizarCancha() {
    const formacion = document.getElementById("formaciones").value;
    const cancha = document.getElementById("cancha");
    cancha.innerHTML = "";

    if (!formacion) return;
     // Áreas grandes
      const areaSuperior = document.createElement("div");
       areaSuperior.className = "area-superior";
       cancha.appendChild(areaSuperior);

      const areaInferior = document.createElement("div");
       areaInferior.className = "area-inferior";
       cancha.appendChild(areaInferior);

// Áreas chicas
      const chicaSuperior = document.createElement("div");
       chicaSuperior.className = "chica-superior";
       cancha.appendChild(chicaSuperior);

      const chicaInferior = document.createElement("div");
       chicaInferior.className = "chica-inferior";
      cancha.appendChild(chicaInferior);


    const posiciones = formaciones[formacion];
    if (!posiciones) return;

    posiciones.forEach((pos, idx) => {
      const divPos = document.createElement("div");
      divPos.className = "posicion";
      divPos.style.top = pos.top + "%";
      divPos.style.left = pos.left + "%";

      
  // Imagen de camiseta
      const imgCamiseta = document.createElement("img");
        imgCamiseta.src = "img/camisetas/boca_Camiseta.png"; // tu ruta
        imgCamiseta.alt = "Camiseta";
        imgCamiseta.className = "camiseta-posicion";
      divPos.appendChild(imgCamiseta);

      // Label posición
      const label = document.createElement("label");
      label.textContent = pos.label;
      divPos.appendChild(label);

      // Select jugador
      const select = document.createElement("select");
      select.className = "jugador-select";
      select.dataset.tipo = pos.tipo;
      select.id = "posicion-" + idx;

      const optionDefault = document.createElement("option");
      optionDefault.value = "";
      optionDefault.textContent = "Elegir jugador";
      select.appendChild(optionDefault);

      // Lista jugadores según tipo
      const listaJugadores = jugadores[pos.tipo] || [];
      listaJugadores.forEach((jug) => {
        const opt = document.createElement("option");
        opt.value = jug;
        opt.textContent = jug;
        select.appendChild(opt);
      });

      divPos.appendChild(select);
      cancha.appendChild(divPos);
    });
  }

  function enviarEquipo() {
    const nickname = document.getElementById("nickname").value.trim();
    if (!nickname) {
      alert("Por favor ingresá tu nickname.");
      return;
    }
    const formacion = document.getElementById("formaciones").value;
    if (!formacion) {
      alert("Por favor seleccioná una formación.");
      return;
    }
    const selects = document.querySelectorAll("#cancha select.jugador-select");
    if (selects.length === 0) {
      alert("Primero seleccioná los jugadores en la formación.");
      return;
    }
    const jugadoresSeleccionados = [];
    for (const select of selects) {
      if (!select.value) {
        alert("Por favor elegí un jugador para cada posición.");
        return;
      }
      jugadoresSeleccionados.push(select.value);
    }

    // Guardar localStorage
    const equiposGuardados = JSON.parse(localStorage.getItem("equipos")) || [];
    equiposGuardados.push({
      nickname,
      formacion,
      jugadores: jugadoresSeleccionados,
      timestamp: new Date().toISOString()
    });
    localStorage.setItem("equipos", JSON.stringify(equiposGuardados));
    alert("✅ Equipo guardado localmente.");
    mostrarEquiposLocal();
  }

  function mostrarEquiposLocal() {
    const lista = document.getElementById("lista-equipos-prueba");
    lista.innerHTML = "";
    const equiposGuardados = JSON.parse(localStorage.getItem("equipos")) || [];
    equiposGuardados.forEach((equipo, idx) => {
      const divEquipo = document.createElement("div");
      divEquipo.className = "equipo-container";

      divEquipo.innerHTML = `
        <div class="info-partido">
          <strong>Nickname:</strong> ${equipo.nickname} <br />
          <strong>Formación:</strong> ${equipo.formacion} <br />
          <small style="font-weight:400; font-size:0.8em;">
            ${new Date(equipo.timestamp).toLocaleString()}
          </small>
        </div>
        <div class="mini-cancha" style="position:relative; height:220px;">
          ${equipo.jugadores.map((jugador, i) => {
            // Posicionar según la formación y la posición
            const formacion = formaciones[equipo.formacion];
            if (!formacion) return "";
            const pos = formacion[i];
            if (!pos) return "";
            return `<div class="mini-posicion" style="top:${pos.top}%; left:${pos.left}%;">
              <label>${pos.label}</label><span>${jugador}</span>
            </div>`;
          }).join('')}
        </div>
      `;
      lista.appendChild(divEquipo);
    });
  }

  function guardarDatosPartido() {
    const rival = document.getElementById("rival").value.trim();
    const estadio = document.getElementById("estadio").value.trim();
    const fecha = document.getElementById("fecha").value;

    if (!rival || !estadio || !fecha) {
      alert("Por favor completá todos los datos del partido.");
      return;
    }

    localStorage.setItem("datosPartido", JSON.stringify({ rival, estadio, fecha }));
    alert("Datos del partido guardados.");
  }

  // Al cargar la página, cargo datos guardados y equipos
  window.onload = () => {
    // Cargar datos partido
    const datosPartido = JSON.parse(localStorage.getItem("datosPartido"));
    if (datosPartido) {
      document.getElementById("rival").value = datosPartido.rival;
      document.getElementById("estadio").value = datosPartido.estadio;
      document.getElementById("fecha").value = datosPartido.fecha;
    }
    mostrarEquiposLocal();
  };
</script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// --- Paso 1: helpers para recordar votos en este navegador ---
const VOTOS_LS_KEY = "equiposVotados";

function getVotedList() {
  try {
    return JSON.parse(localStorage.getItem(VOTOS_LS_KEY)) || [];
  } catch (e) {
    return [];
  }
}

function hasVoted(idEquipo) {
  if (!idEquipo) return false;
  return getVotedList().includes(idEquipo);
}

function markVoted(idEquipo) {
  if (!idEquipo) return;
  const arr = getVotedList();
  if (!arr.includes(idEquipo)) {
    arr.push(idEquipo);
    localStorage.setItem(VOTOS_LS_KEY, JSON.stringify(arr));
  }
}

const firebaseConfig = {
  apiKey: "AIzaSyBEXNvtQPci2sx4_a3JSDt6S2YDW4Qs9RE",
  authDomain: "el11deboca.firebaseapp.com",
  projectId: "el11deboca",
  storageBucket: "el11deboca.firebasestorage.app",
  messagingSenderId: "275338094752",
  appId: "1:275338094752:web:2275f85837deb1127b41c5",
  measurementId: "G-XCG9CRTZEB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function mostrarEquiposFirebase(equipos) {
  const contenedor = document.getElementById("equipos-firebase");
  contenedor.innerHTML = "";

  // Ordenar equipos por votos descendente
  equipos.sort((a, b) => (b.votos || 0) - (a.votos || 0));

  const reemplazos = {
    "Carlos Palacios D": "Palacios",
    "Carlos Palacios V": "Palacios",
    "Rodrigo Battaglia": "Battaglia",
    "Rodrigo Battaglia V": "Battaglia",
    "Rodrigo Battaglia D": "Battaglia",
    "Lautaro Di Lollo": "Di Lollo",
  };

  equipos.forEach((equipo) => {
    const div = document.createElement("div");
    div.className = "equipo-container";
    div.style.marginBottom = "1rem";

    const nombre = equipo.nickname || "Anónimo";

    div.innerHTML = `
      <div class="info-partido">
        <strong>Ayudante de Campo:</strong> ${nombre} <br />
        <strong>Formación:</strong> ${equipo.formacion || "No definida"} <br />
        </small>
      </div>
      <div class="mini-cancha" style="position:relative; height:220px;">
  ${equipo.jugadores && equipo.formacion && formaciones[equipo.formacion]
    ? equipo.jugadores.map((jugador, i) => {
        const pos = formaciones[equipo.formacion][i];
        if (!pos) return "";

        let apellido = jugador;
        if (reemplazos[jugador]) apellido = reemplazos[jugador];
        else {
          const partes = jugador.trim().split(" ");
          apellido = partes[partes.length - 1];
        }

        // Ajustar top según la línea del jugador
        let topPos = pos.top; // valor original
        const label = pos.label.toLowerCase();

        if (label.includes("delantero")) {
          topPos -= 10; // mover delanteros más arriba
          if(topPos < 0) topPos = 0; // no salir de la cancha
        } else if(label.includes("mediocampista")) {
          topPos -= 5; // opcional, un poco más arriba
          if(topPos < 0) topPos = 0;
        } 
        // defensores y arquero mantienen top original

        return `<div class="mini-posicion" style="top:${topPos}%; left:${pos.left}%;"><label>${pos.label}</label><span>${apellido}</span></div>`;
      }).join("")
    : "<em>Formación o jugadores incompletos</em>"}
</div>



      <button class="boton-me-gusta" data-id="${equipo.id}">
        👍 Me gusta (${equipo.votos || 0})
      </button>
    `;

    // Botón Me gusta
    const btn = div.querySelector(".boton-me-gusta");
    btn.addEventListener("click", async () => {
      if (!equipo.id) {
        alert("Error: No se puede votar este equipo");
        return;
      }

      const votosPrevios = JSON.parse(localStorage.getItem("equiposVotados") || "[]");
      if (votosPrevios.includes(equipo.id)) {
        alert("⚠️ Ya votaste este equipo.");
        return;
      }

      const docRef = doc(db, "equipos", equipo.id);
      try {
        await updateDoc(docRef, { votos: (equipo.votos || 0) + 1 });
        votosPrevios.push(equipo.id);
        localStorage.setItem("equiposVotados", JSON.stringify(votosPrevios));
        alert(`¡Votaste por el equipo de ${nombre}!`);
      } catch (error) {
        alert("Error al votar: " + error.message);
        console.error(error);
      }
    });

    // --- BOTÓN COMPARTIR ---
    const btnCompartir = document.createElement("button");
    btnCompartir.textContent = "📸 Compartir este equipo";
    btnCompartir.classList.add("boton-compartir");

    btnCompartir.addEventListener("click", () => {
      html2canvas(div, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const a = document.createElement('a');
        a.href = imgData;
        a.download = "mi_equipo.png";
        a.click();
      });
    });

    div.appendChild(btnCompartir);

    // Agregar div al contenedor
    contenedor.appendChild(div);
  });
}

const jugadoresConFotos = {
  "Miguel Merentiel": "img/jugadores/merentiel.png",
  "Leandro Brey": "img/jugadores/brey.png",
  "Lautaro Blanco": "img/jugadores/blanco.png",
  "Lautaro Di Lollo": "img/jugadores/dilollo.png",
  "Ayrton Costa": "img/jugadores/costa.png",
  "Carlos Palacios": "img/jugadores/palacios.png",
  "Leandro Paredes": "img/jugadores/paredes.png",
  "Kevin Zenon": "img/jugadores/zenon.png",
  "Alan Velasco": "img/jugadores/velasco.png",
  "Agustin Marchesin": "img/jugadores/marchesin.png",
  "Marco Pellegrino": "img/jugadores/pellegrino.png",
  "Brian Aguirre": "img/jugadores/aguirre.png",
  "Rodrigo Battaglia": "img/jugadores/battaglia.png",
  "Ezequiel Zeballos": "img/jugadores/zeballos.png",
  "William Alarcon": "img/jugadores/alarcon.png",
  "Edinson Cavani": "img/jugadores/cavani.png",
  "Juan Barinaga": "img/jugadores/barinaga.png",
  "Milton Gimenez": "img/jugadores/gimenez.png",
  "Ander Herrera": "img/jugadores/herrera.png",
  "Milton Delgado": "img/jugadores/delgado.png",
  "Lucas Blondel": "img/jugadores/blondel.png",
  "Luis Advincula": "img/jugadores/advincula.png",
  "Tomas Belmonte": "img/jugadores/belmonte.png",
  "Nicolas Figal": "img/jugadores/figal.png",
  "Frank Fabra": "img/jugadores/fabra.png",
  "Lucas Janson": "img/jugadores/janson.png",
  "Sergio Romero": "img/jugadores/romero.png",
  "Camilo Rey Domenech": "img/jugadores/reydomenech.png",
  "Mateo Mendia": "img/jugadores/mendia.png",
};


function mostrarOnceIdeal(equipos) {
  const contenedor = document.getElementById("once-ideal");
  const canchaIdeal = document.getElementById("cancha-ideal");

  if (!equipos.length) {
    contenedor.style.display = "none";
    return;
  }

  // Buscar el equipo con más votos
  let equipoTop = null;
  let maxVotos = -1;
  equipos.forEach(equipo => {
    if ((equipo.votos || 0) > maxVotos) {
      maxVotos = equipo.votos || 0;
      equipoTop = equipo;
    }
  });

  if (!equipoTop || !equipoTop.jugadores || !equipoTop.formacion) {
    contenedor.style.display = "none";
    return;
  }

  canchaIdeal.innerHTML = ""; // limpio antes
  // Agregar áreas de la cancha
const areaSuperior = document.createElement("div");
areaSuperior.className = "area-superior";
canchaIdeal.appendChild(areaSuperior);

const areaInferior = document.createElement("div");
areaInferior.className = "area-inferior";
canchaIdeal.appendChild(areaInferior);

// Si querés también las áreas chicas (opcional)
const chicaSuperior = document.createElement("div");
chicaSuperior.className = "chica-superior";
canchaIdeal.appendChild(chicaSuperior);

const chicaInferior = document.createElement("div");
chicaInferior.className = "chica-inferior";
canchaIdeal.appendChild(chicaInferior);


  
  const posicionesBase = formaciones[equipoTop.formacion];
  if (!posicionesBase) {
    contenedor.style.display = "none";
    return;
  }

  // Función para obtener apellido, con excepciones
  const obtenerApellido = (nombreCompleto) => {
    const excepciones = ["Palacios", "Battaglia", "Di Lollo"];
    for (let excep of excepciones) {
      if (nombreCompleto.includes(excep)) return excep;
    }
    return nombreCompleto.split(" ").pop();
  };

equipoTop.jugadores.forEach((jugador, i) => {
    const pos = posicionesBase[i];
    if (!pos) return;

    const divPos = document.createElement("div");
    divPos.className = "posicion-ideal";
    divPos.style.top = pos.top + "%";
    divPos.style.left = pos.left + "%";
    // Obtenemos la foto desde la carpeta img/jugadores
  const urlFoto = jugadoresConFotos[jugador.trim()] || 'https://via.placeholder.com/80';

  // Detectar si es móvil
    const esMobile = window.innerWidth <= 480;

    divPos.innerHTML = `
      <div class="carta-jugador">
        <img src="${urlFoto}" alt="${jugador}" class="foto-jugador">
        ${esMobile 
          ? `<div class="nombre-jugador">${jugador}</div>` 
          : `<div class="nombre-jugador">${obtenerApellido(jugador)}</div>`}
      </div>
    `;

  canchaIdeal.appendChild(divPos);
});


  // Mostrar título con el nombre del equipo más votado
  let tituloTop = document.getElementById("nombre-equipo-top");
  if (!tituloTop) {
    tituloTop = document.createElement("h3");
    tituloTop.id = "nombre-equipo-top";
    tituloTop.style.textAlign = "center";
    tituloTop.style.marginBottom = "0.5rem";
    contenedor.insertBefore(tituloTop, canchaIdeal);
  }
  tituloTop.textContent = `Equipo más votado: ${equipoTop.nickname || "Anónimo"} (${maxVotos} votos)`;

  contenedor.style.display = "block";
}

const q = query(collection(db, "equipos"), orderBy("timestamp", "desc"));
let equiposCache = []; // Guardamos todos los equipos

onSnapshot(q, (snapshot) => {
  equiposCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

  // Actualizamos el select de rivales
  actualizarSelectRivales(equiposCache);

  // Filtramos por el próximo rival si existe
  let equiposParaMostrar = equiposCache;
  if (window.rivalActual) {
    equiposParaMostrar = equiposCache.filter(e => e.rival === window.rivalActual);
  }

  // Mostramos los equipos filtrados
  mostrarEquiposFirebase(equiposParaMostrar);
  mostrarOnceIdeal(equiposParaMostrar); 
});

// Función para actualizar el select de rivales
function actualizarSelectRivales(equipos) {
  const select = document.getElementById("filtro-rival");
  const rivalesUnicos = [...new Set(equipos.map(e => e.rival).filter(Boolean))];

  // Limpiar opciones (dejando "Todos")
  select.innerHTML = '<option value="">Todos</option>';

  rivalesUnicos.forEach(rival => {
    const option = document.createElement("option");
    option.value = rival;
    option.textContent = rival;
    select.appendChild(option);
  });
}

// Evento para filtrar por rival
document.getElementById("filtro-rival").addEventListener("change", (e) => {
  const rivalSeleccionado = e.target.value;
  let equiposFiltrados = equiposCache;

  if (rivalSeleccionado) {
    equiposFiltrados = equiposCache.filter(e => e.rival === rivalSeleccionado);
  }

  mostrarEquiposFirebase(equiposFiltrados);
  mostrarOnceIdeal(equiposFiltrados);

  // Mensaje de info
  const info = document.getElementById("filtro-info");
  info.textContent = rivalSeleccionado ? `Mostrando equipos para: ${rivalSeleccionado}` : "";
});



window.enviarEquipoFirebase = async () => {
  

  const nickname = document.getElementById("nickname").value.trim();
  const formacion = document.getElementById("formaciones").value;

  if (!nickname) {
    alert("Por favor ingresá tu nickname.");
    return;
  }
  if (!formacion) {
    alert("Por favor seleccioná una formación.");
    return;
  }

  const selects = document.querySelectorAll("#cancha select.jugador-select");
  if (selects.length === 0) {
    alert("Primero seleccioná los jugadores en la formación.");
    return;
  }

  const jugadoresSeleccionados = [];
  for (const select of selects) {
    if (!select.value) {
      alert("Por favor elegí un jugador para cada posición.");
      return;
    }
    if (jugadoresSeleccionados.includes(select.value)) {
    alert(`⚠️ El jugador "${select.value}" ya fue elegido en otra posición.`);
    return;
    }
    jugadoresSeleccionados.push(select.value);
  }

  try {
    await addDoc(collection(db, "equipos"), {
      nickname,
      formacion,
      jugadores: jugadoresSeleccionados,
      rival: window.rivalActual,   // ✅ rival desde index.js
      timestamp: new Date(),
      votos: 0,
    });


     // Primero aviso que se envió
  alert("✅ Equipo enviado correctamente.");

  // Después mostramos el modal de Russo
  mostrarModalRusso();
  } catch (error) {
    alert("❌ Error al guardar el equipo: " + error.message);
    console.error("Firebase error:", error);
  }
  function mostrarModalRusso() {
  const modal = document.getElementById("modal-russo");
  modal.style.opacity = 0;
  modal.style.display = "flex"; // mostrar modal

  // Fade in
  let op = 0;
  const fadeIn = setInterval(() => {
    if (op >= 1) {
      clearInterval(fadeIn);
      // Mantener visible 3 segundos
      setTimeout(() => {
        // Fade out
        let opOut = 1;
        const fadeOut = setInterval(() => {
          if (opOut <= 0) {
            clearInterval(fadeOut);
            modal.style.display = "none";
          } else {
            opOut -= 0.05;
            modal.style.opacity = opOut;
          }
        }, 20);
      }, 2000);
    } else {
      op += 0.05;
      modal.style.opacity = op;
    }
  }, 30);

  // Cerrar al hacer clic fuera del contenido
  modal.onclick = (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
      modal.style.opacity = 0;
    }
  };
}

};

  window.shareTwitter = function() {
  const url = encodeURIComponent(window.location.href);
  const text = encodeURIComponent("Mirá esta página increíble!");
  const twitterUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
  window.open(twitterUrl, "_blank");
}

window.shareWhatsApp = function() {
  const url = encodeURIComponent(window.location.href);
  const text = encodeURIComponent("Mirá esta página increíble!");
  const waUrl = `https://api.whatsapp.com/send?text=${text}%20${url}`;
  window.open(waUrl, "_blank");
}


</script>




<script type="module" src="index.js"></script>
<!-- Al final del <body>, antes de </body> -->
<footer style="text-align:center; padding: 10px; background-color: #002244; color: #FFD700; font-size: 14px;">
  Contacto: 
  <a href="https://x.com/tuoncexeneize" target="_blank" style="color: #FFD700; text-decoration: none;">
    @tuoncexeneize
  </a> en X
</footer>

<!-- MODAL DE RUSSO -->
<div id="modal-russo">
  <div class="modal-contenido">
    <img src="russo1.jpg" alt="Miguel Russo" />
    <p>Miguelo te lo agradece 🙌</p>
  </div>
</div>


</div>
</body>
</html>



